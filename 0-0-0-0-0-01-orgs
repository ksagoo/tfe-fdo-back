def build_cloned_list_id_map(session, base_url, access_group_prefix):
    url = f"{base_url}/client-list/v1/lists"
    response = session.get(url)
    response.raise_for_status()

    lists = response.json().get("listItems", [])
    id_map = {}

    name_to_id = {lst["name"]: lst["uniqueId"] for lst in lists if "name" in lst and "uniqueId" in lst}

    print("\n[DEBUG] Listing all available client lists:")
    for name, uid in name_to_id.items():
        print(f"- {name} â†’ {uid}")

    for template_name, template_id in name_to_id.items():
        if template_name.startswith("Security Policy Template "):
            suffix = template_name.replace("Security Policy Template ", "").strip()
            expected_clone = f"SC-{access_group_prefix} {suffix}"
            if expected_clone in name_to_id:
                clone_id = name_to_id[expected_clone]
                id_map[template_id] = clone_id
                print(f"[INFO] Matched template '{template_name}' to clone '{expected_clone}'")

    if not id_map:
        print("[WARN] No matches found in template to clone mapping.")

    return id_map
