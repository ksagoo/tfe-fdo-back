def clone_and_rename_client_lists(session, base_url, config_id, version, access_group, section):
    print(f"[INFO] DRY RUN: Cloning and renaming client lists from Security Policy Template")
    summary = {
        "processed": 0,
        "successful": 0,
        "failed": 0,
        "results": []
    }

    # Fetch all client lists
    url = f"{base_url}/client-list/v1/lists?includeDeprecated=true&includeNetworkLists=true"
    try:
        response = session.get(url)
        response.raise_for_status()
        client_lists = response.json().get("content", [])
    except Exception as e:
        print(f"[ERROR] Failed to fetch client lists: {e}")
        return summary

    # Build a dict of existing lists {name: full_json}
    existing_lists = {cl.get("name", ""): cl for cl in client_lists}

    for cl in client_lists:
        try:
            name = cl.get("name", "")
            if not name.startswith("Security Policy Template"):
                continue

            suffix = name.replace("Security Policy Template", "").strip(" -:")
            new_name = f"SC-{access_group}-{suffix}"

            if new_name in existing_lists:
                existing_cl = existing_lists[new_name]
                delete_flag = existing_cl.get("availableActions", {}).get("DELETE", {}).get("available", False)
                
                print(f"[DEBUG] Existing target list found: {new_name}")
                print(json.dumps(existing_cl, indent=2))  # full JSON for inspection

                if not delete_flag:
                    print(f"[SKIP] List '{new_name}' already exists and is not deletable")
                    continue
                else:
                    print(f"[INFO] List '{new_name}' exists but is deletable â€” will re-clone")

            print(f"[DRYRUN] Would clone '{name}' to '{new_name}' using listId={cl.get('listId')}")
            summary["processed"] += 1
            summary["results"].append({
                "source": name,
                "target": new_name,
                "status": "dryrun"
            })

        except Exception as e:
            print(f"[ERROR] Failed during dryrun for '{name}': {e}")
            summary["processed"] += 1
            summary["failed"] += 1
            summary["results"].append({
                "source": name,
                "status": "error",
                "error": str(e)
            })

    return summary
