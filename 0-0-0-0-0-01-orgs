def build_bypass_list_from_client_lists(session, base_url, access_group, account, is_prod):
    print(f"[INFO] Building bypass list for access_group={access_group}, account={account}, is_prod={is_prod}")
    
    bypass_list = []
    matches = search_client_lists_by_name(session, base_url, "")  # fetch all

    def find_match(keyword):
        for list_id, name in matches:
            if keyword.lower() in name.lower():
                return {"id": list_id, "type": "IP", "listType": "CL"}
        print(f"[WARN] No client list match found for: {keyword}")
        return None

    # Always add SC-<access_group>
    access_group_list = find_match(f"SC-{access_group}")
    if access_group_list:
        bypass_list.append(access_group_list)

    # Environment-specific logic
    if is_prod:
        if account.lower() == "dev":
            account_list = find_match("VUL-SCAN-APAC")
        else:
            account_list = find_match(f"VUL-SCAN-{account}")
        if account_list:
            bypass_list.append(account_list)
    else:
        preprod_list = find_match("VUL-SCAN-PRE-PROD")
        if preprod_list:
            bypass_list.append(preprod_list)

    return bypass_list
