import socket

def domain_exists_socket(domain):
    try:
        ip = socket.gethostbyname(domain)
        print(f"{domain} resolves to {ip}.")
        return True
    except socket.gaierror:
        print(f"{domain} does not resolve.")
        return False


def can_create_enrollment(session, base_url, contract_id, common_name):
    # Check if the domain resolves via DNS.
    if not domain_exists_socket(common_name):
        print(f"Domain {common_name} does not resolve in DNS.")
        return False
    
    # Check if the common name is already in an enrollment.
    if common_name_exists(session, base_url, contract_id, common_name):
        print(f"Common name {common_name} is already in use in an existing enrollment.")
        return False

    return True

# Then in your main code:
if args.operation == "create":
    if not can_create_enrollment(session, base_url, contract_id, args.common_name):
        sys.exit(1)
