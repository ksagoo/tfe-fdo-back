def get_policy_id_from_metadata(policy_prefix, security_policies_json, metadata):
    """
    Looks up a policy ID by prefix using expected names from config_metadata.json.
    """
    for key in ['prod', 'nonprod']:
        if metadata.get("default_policies", {}).get(key, {}).get("prefix") == policy_prefix:
            expected_name = metadata["default_policies"][key]["name"]
            for policy in security_policies_json:
                if policy.get("policyName") == expected_name:
                    return policy.get("policyId")
    return None


with open("config_metadata.json") as f:
    metadata = json.load(f)

# policies_response = session.get(...)  # Already done elsewhere
policy_id = get_policy_id_from_metadata(policy_prefix, policies_response.json().get("securityPolicies", []), metadata)
