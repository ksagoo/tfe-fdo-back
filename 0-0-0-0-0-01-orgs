[
{% for target in targets %}
{
  "securityPolicyId": "{{ target.policy_id }}",
  "type": {{ target.match_types | tojson }},
  "matchType": "hostname",
  "sequence": 0,
  "useHeaders": [],
  "isNegativeFileExtensionMatch": {{ target.is_negative_file_extension_match | default(false) | lower }},
  "isSharedAliasMatch": false,
  "fileExtensions": [{% for ext in target.file_extensions %}"{{ ext }}"{% if not loop.last %}, {% endif %}{% endfor %}],
  "hostnames": [{% for h in target.hostnames %}"{{ h }}"{% if not loop.last %}, {% endif %}{% endfor %}],
  "pathMatchType": "PREFIXED",
  "matches": [
    {
      "matchOperator": "IS_ONE_OF",
      "values": [{% for p in target.paths %}"{{ p }}"{% if not loop.last %}, {% endif %}{% endfor %}]
    }
  ]
}
{% if not loop.last %},{% endif %}
{% endfor %}
]

rendered = render_template(env, "match_targets.j2", {"targets": config["match_targets"]})
