def clone_and_rename_client_lists(session, base_url, config_id, version, access_group, section, dry_run=True):
    print(f"[INFO] {'[DRY RUN] ' if dry_run else ''}Cloning client lists from Security Policy Template...")

    summary = {
        "processed": 0,
        "successful": 0,
        "failed": 0,
        "skipped_existing": [],
        "results": []
    }

    def normalize(name):
        return name.strip().lower()

    try:
        # Ensure section is passed into the GET request to include correct scoped lists
        url = f"{base_url}/client-list/v1/lists?includeDeprecated=true&includeNetworkLists=true"
        if section:
            url += f"&section={section}"

        resp = session.get(url)
        resp.raise_for_status()
        client_lists = resp.json().get("content", [])
        print(f"[INFO] Retrieved {len(client_lists)} client lists from API.")
    except Exception as e:
        print(f"[ERROR] Failed to fetch client lists: {e}")
        return summary

    # Debug: show all SC- lists with deprecated status
    print("\n[DEBUG] Existing SC-* lists and deprecated status:")
    for cl in client_lists:
        name = cl.get("name", "")
        if name.startswith("SC-"):
            deprecated = cl.get("deprecated", False)
            print(f"  - {name} | deprecated: {deprecated}")

    # Process only "Security Policy Template" lists
    for cl in client_lists:
        original_name = cl.get("name", "")
        if not original_name.startswith("Security Policy Template"):
            continue

        suffix = original_name.replace("Security Policy Template", "").strip()
        new_name = f"SC-{access_group}-{suffix}"
        norm_new_name = normalize(new_name)

        # Find all lists with the target name
        matching = [x for x in client_lists if normalize(x.get("name", "")) == norm_new_name]
        print(f"\n[DEBUG] Found {len(matching)} lists matching '{new_name}'")

        still_in_use = False
        for match in matching:
            deprecated = match.get("deprecated", False)
            print(f"[DEBUG]   - listId: {match.get('listId')}, deprecated: {deprecated}")
            if deprecated is False:
                still_in_use = True
                break

        if still_in_use:
            print(f"[SKIP] '{new_name}' already exists and is in use (deprecated = false). Skipping.")
            summary["skipped_existing"].append(new_name)
            continue

        # Build payload for cloning
        payload = {
            "name": new_name,
            "type": cl.get("type"),
            "listType": cl.get("listType"),
            "description": f"Cloned from template list '{original_name}'",
            "tags": [],
            "cloneFromList": {
                "listId": cl.get("listId")
            }
        }

        if dry_run:
            print(f"[DRY RUN] Would clone: '{original_name}' => '{new_name}'")
            summary["successful"] += 1
            summary["results"].append({
                "status": "dry-run",
                "source": original_name,
                "target": new_name
            })
        else:
            clone_url = f"{base_url}/client-list/v1/lists"
            if section:
                clone_url += f"?section={section}"

            try:
                response = session.post(clone_url, json=payload)
                response.raise_for_status()
                created_id = response.json().get("listId")
                print(f"[SUCCESS] Cloned: '{original_name}' => '{new_name}' (listId: {created_id})")
                summary["successful"] += 1
                summary["results"].append({
                    "status": "success",
                    "source": original_name,
                    "target": new_name,
                    "listId": created_id
                })
            except Exception as e:
                print(f"[ERROR] Failed to clone '{original_name}' to '{new_name}': {e}")
                summary["failed"] += 1
                summary["results"].append({
                    "status": "failed",
                    "source": original_name,
                    "target": new_name,
                    "error": str(e)
                })

        summary["processed"] += 1

    print("\n[SUMMARY]")
    print(json.dumps(summary, indent=2))
    return summary
