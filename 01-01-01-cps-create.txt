if not dry_run:
    # Fetch contract and account switch key from region settings or config
    contract_id = REGION_SETTINGS.get(section, {}).get("contractId", None)
    account_switch_key = REGION_SETTINGS.get(section, {}).get("accountSwitchKey", None)

    if not contract_id:
        print(f"[FAILURE]: Missing contractId for section [{section}] â€” required for CPS API.")
        return []

    url = f"{base_url}/cps/v2/enrollments?contractId={contract_id}"
    if account_switch_key:
        url += f"&accountSwitchKey={account_switch_key}"

    headers = {
        "accept": "application/vnd.akamai.cps.enrollments.v11+json"
    }

    try:
        response = session.get(url, headers=headers)
        if response.status_code != 200:
            print(f"[FAILURE]: Discovery failed: {response.status_code}")
            return []

        data = response.json().get("enrollments", [])
        print(f"[SUCCESS]: Retrieved {len(data)} enrollments")
        return data

    except Exception as e:
        print(f"[FAILURE]: Discovery request error: {e}")
        return []
