import json
import os

def write_json_safely(filename, resp):
    """
    Writes an API response safely as formatted JSON to the output directory.
    Handles invalid or non-JSON responses gracefully.
    """
    os.makedirs("output", exist_ok=True)
    path = os.path.join("output", filename)
    try:
        # Try JSON first
        data = resp.json()
        with open(path, "w", encoding="utf-8") as f:
            json.dump(data, f, indent=2)
    except Exception:
        # Fall back to plain text if not valid JSON
        with open(path, "w", encoding="utf-8") as f:
            f.write(resp.text)
